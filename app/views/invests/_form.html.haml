= simple_form_for [@fund, @invest] do |f|
	= f.input :fund_id, value: @fund.id, as: :hidden
	= f.input :date, as: :hidden
	.form-group

		%label
			= "剩余投资额 : " + (@fund.amount - @invests.sum(:amount)).to_s() +"元"
		%br
		%label
			= "最小投资额 : "
			- if @fund.minimum
				= @fund.minimum.to_s()
			- else
				0.0
			= "元"
		%br
		%label
			= Invest.human_attribute_name('amount')
			\:
		.input-group
			%input#invest_input_can.form-control.text-center.numberic{:name => "invest[amount]",:maxlength => 7,:placeholder => "大于等于最小投资额，小于等于剩余投资额"}
			%span.input-group-addon  元
	.mb10
		%input#check{:type => "checkbox",:checked => ""}/
		我已阅读并同意
		%a.color-blue.sky-blue-i.gppz_items{:href => "javascript:;"} 条款
	= f.submit class: "hide",id: 'subbtn'
	%button.btn-u.btn-u-red#submit{:name => "commit", :type => "button"} 我要投资

:javascript
	$(function(){
		var minimum = parseInt("#{@fund.minimum}");
		var maxmum = parseInt("#{(@fund.amount - @invests.sum(:amount))}");
		if(maxmum > 0 && maxmum < minimum) {
			minimum = maxmum;
		}
		$('#submit').bind('click',function(){
			var crt_amount = parseInt($("#invest_input_can").val()) || 0;

			if (maxmum <= 0) {
				alert("当前标的已投满，正等待审核");
				return;
			}
			if (crt_amount < minimum) {
				alert("您输入的投资额小于最小投资额");
				return;
			}
			var myBalance = parseFloat("#{current_user.account.balance if current_user}");
			if (crt_amount > myBalance) {
				if(confirm("您余额不足，请充值，确认充值？")){
					window.open("#{bankcard_charge_user_account_path(current_user) if current_user} #{'javascript:;' unless current_user}");
				}
				return;
			}
			if (crt_amount < 1) {
				alert("投标金额必须大于等于1元");
				return;
			}
		  if($(this).closest('form').find('#check').attr('checked')){
		    $('#subbtn').click();
		  }else{
		    alert('请您先阅读并勾选确认条款');
		  }
		});
		$(".gppz_items").click(function(){
			var winHeight = 600;
			var winWidth = 600;
			var winLeft = (screen.width-600)/2;
			var winTop = (screen.height-600)/2;
			window.open("/gppz_items.html", "newwindow", "height="+winHeight+", width="+winWidth+", toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no, left="+winLeft+", top="+winTop);
		});
		$("#invest_input_can").bind('input', function() {
			var crt_amount = parseInt($(this).val()) || 0;
			if (crt_amount > maxmum) {
				crt_amount = maxmum;
			}else if (crt_amount < minimum) {
				//crt_amount = minimum;
			}

			$(this).val(crt_amount);
		});
	});
