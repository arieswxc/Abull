!!!
%html
  %head
    %meta{:content => "text/html; charset=UTF-8", "http-equiv" => "Content-Type"}/
    %title 摩尔街
    = stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true
    / CSS Global Compulsory
    %link{:href => asset_path("one.css"), :rel => "stylesheet"}/
    %link{:href => asset_path("plugins/bootstrap.min.css"), :rel => "stylesheet"}/
    %link{:href => asset_path("style.css"), :rel => "stylesheet"}/
    %link{:href => asset_path("one.style.css"), :rel => "stylesheet"}/
    / CSS Implementing Plugins
    %link{:href => asset_path("plugins/line-icons.css"), :rel => "stylesheet"}/
    %link{:href => asset_path("plugins/font-awesome/css/font-awesome.min.css"), :rel => "stylesheet"}/
    %link{:href => asset_path("plugins/img-hover.css"), :rel => "stylesheet"}/
    %link{:href => asset_path("plugins/jquery.fancybox.css"), :rel => "stylesheet"}/
    %link{:href => asset_path("sky-forms.css"), :rel => "stylesheet"}/
    %link{:href => asset_path("custom-sky-forms.css"), :rel => "stylesheet"}/
    / CSS Page Style
    %link{:href => asset_path("pages/blog.css"), :rel => "stylesheet"}/
    %link{:href => asset_path("pages/page_log_reg_v1.css"), :rel => "stylesheet"}/
    / CSS Theme
    %link{:href => asset_path("theme-colors/default.css"), :rel => "stylesheet"}/
    %link{:href => asset_path("shop.style.css"), :rel => "stylesheet"}/
    %link{:href => asset_path("plugins/perfect-scrollbar.css"), :rel => "stylesheet"}/
    %link{:href => asset_path("plugins/owl.carousel.css"), :rel => "stylesheet"}/
    %link{:href => asset_path("plugins/settings.css"), :rel => "stylesheet"}/
    %link{:href => asset_path("pages/page_job.css"), :rel => "stylesheet"}/
    %link{:href => asset_path("pages/feature_timeline2.css"), :rel => "stylesheet"}/
    / CSS Customization
    %link{:href => asset_path("custom.css"), :rel => "stylesheet"}/
    %link{:href => asset_path("common.css"), :rel => "stylesheet"}/
    = javascript_include_tag 'application', 'data-turbolinks-track' => true
    %script{:src => asset_path("plugins/jquery-migrate.min.js"), :type => "text/javascript"}
    -# %script{:src => asset_path("plugin.js"), :type => "text/javascript"}


    = csrf_meta_tags
  %body
    .wapper
      = render "shares/navbar"
      = yield
      = render "shares/footer"
    / JS Implementing Plugins

    %script{:src => asset_path("plugins/back-to-top.js"), :type => "text/javascript"}
    %script{:src => asset_path("plugins/owl.carousel.js")}
    %script{:src => asset_path("plugins/jquery.mousewheel.js")}
    %script{:src => asset_path("plugins/perfect-scrollbar.js")}
    %script{:src => asset_path("plugins/jquery.parallax.js")}
    %script{:src => asset_path("plugins/jquery.themepunch.tools.min.js")}
    %script{:src => asset_path("plugins/jquery.themepunch.revolution.min.js")}
    %script{:src => asset_path("plugins/moment-with-locales.js")}
    %script{:src => asset_path("plugins/jquery.fancybox.pack.js")}
    %script{:src => asset_path("plugins/fancy-box.js")}
    / JS Customization
    %script{:src => asset_path("custom.js")}
    / JS Page Level
    %script{:src => asset_path("shop.app.js")}
    %script{:src => asset_path("plugins/owl-carousel.js")}
    %script{:src => asset_path("plugins/revolution-slider.js")}
    %script{:src => asset_path("plugins/Chart.min.js")}
    / JS Page Level
    %script{:src => asset_path("common.js")}
    :javascript
      jQuery(document).ready(function() {
        App.init();
        App.initParallaxBg();
        OwlCarousel.initOwlCarousel();
        RevolutionSlider.initRSfullWidth();
        FancyBox.initFancybox();
        $(".formattime").each(function() {
          $(this).text(moment($(this).text()).format('YYYY-MM-DD hh:mm'));
        });

        $(".pz_tips_1").hover(function(){
          $(this).children(".pz_tips_bd").show();
        },function() {
          $(this).children(".pz_tips_bd").hide();
        });
        $(".numberic").each(function(){
          this.oninput = function() {
            var crt_amount = parseInt($(this).val()) || 0;
            $(this).val(crt_amount);
          }
        });
        $("#selectAvatarBtn").on('change',function(){
          var _self = this;
          if (_self.files.length == 0) return;
          var data = new FormData();
          data.append('avatar', _self.files[0]);
          $(".picloader").show();
          alert('正在上传请稍候...');
          $.ajax({
            data:data,
            url: "/users/#{current_user.id if current_user}/save_avatar",
            type: 'post',
            contentType: false,
            processData: false,
            // xhr: xhr_provider,
            success: function () {
              var reader = new FileReader();
              reader.onload = function(event) {
                  var dataUri = event.target.result,
                        img  = $("#selectAvatar")[0].nextElementSibling;
                  img.src = dataUri;
              };

              reader.onerror = function(event) {
                  console.error("File could not be read! Code " + event.target.error.code);
              };

              reader.readAsDataURL(_self.files[0]);
              $(".picloader").hide();
              alert('上传成功...');
            },
            error: function () {
              $(".picloader").hide();
              alert('上传失败...');
            }
          });
        });
        $("#selectAvatar").on('change',function(){
          var _self = this;
          if (_self.files.length == 0) return;
          var data = new FormData();
          data.append('avatar', _self.files[0]);
          $(".picloader").show();
          alert('正在上传请稍候...');
          $.ajax({
            data:data,
            url: "/users/#{current_user.id if current_user}/save_avatar",
            type: 'post',
            contentType: false,
            processData: false,
            // xhr: xhr_provider,
            success: function () {
              var reader = new FileReader();
              reader.onload = function(event) {
                  var dataUri = event.target.result,
                        img  = _self.nextElementSibling;
                  img.src = dataUri;
              };

              reader.onerror = function(event) {
                  console.error("File could not be read! Code " + event.target.error.code);
              };

              reader.readAsDataURL(_self.files[0]);
              $(".picloader").hide();
              alert('上传成功...');
            },
            error: function () {
              $(".picloader").hide();
              alert('上传失败...');
            }
          });
        });
      });
