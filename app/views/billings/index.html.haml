- @activeSubItem = 'billings'
.pg-container-content
  #pg-account-index.pg-account
    .container_12.mt10.fn-clear
      = render "shares/profile_side_navbar", {activeItem: "account"}
      .inline-block.relative.pg-account-detail
        = render "shares/profile"
        .tab-v2
          %ul.nav.nav-tabs
            %li.active
              %a{"data-toggle" => "tab", :href => "#billings"} 交易记录
          .tab-content
            #billings.tab-pane.fade.active.in
              %table.table.table-bordered
                %thead
                  %th 时间
                  %th 订单号
                  %th User name
                  %th 充值方式
                  %th 金额
                  %th Billable Type
                  %th Billable id
                  %th 状态
                  %th 在线付款
                %tbody
                  = render @billings

= render "profile/cash_management/charge_confirm"

:javascript
  $(function(){
    $("#billings a").click(function(){
      var index = this.dataset.index;
      var newTab=window.open('about:blank');
      $.ajax({
        url: "/billings/"+index+"/realtime_trade",
        type: 'get',
        // contentType: false,
        // processData: false,
        success: function(data){
          if(!newTab){
            alert("弹出的订单处理窗口被阻止了，请手动设置允许此窗口被打开。");
          }else{
            try{
              newTab.location.href=data.url;
            }catch(exp){
              alert("弹出的订单处理窗口被手动关闭了");
            }
          }
          $("#chargeConfirm").modal();
        },
        error: function(){
          alert("系统繁忙，请稍后再试...");
        }
      })
    });
  });
